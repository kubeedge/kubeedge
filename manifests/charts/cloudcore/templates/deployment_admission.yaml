{{- if (.Values.admission.enable) }}
apiVersion: apps/v1
kind: Deployment
metadata:
  {{- with .Values.admission.labels }}
  labels: {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- with .Values.admission.annotations }}
  annotations: {{- toYaml . | nindent 4 }}
  {{- end }}
  name: kubeedge-admission
  namespace: kubeedge
spec:
  replicas: {{ .Values.admission.replicaCount }}
  selector:
    {{- with .Values.admission.labels }}
    matchLabels: {{- toYaml . | nindent 6 }}
    {{- end }}
  template:
    metadata:
      {{- with .Values.admission.labels }}
      labels: {{- toYaml . | nindent 8 }}
      {{- end }}
    spec:
      {{- with .Values.admission.image.pullSecrets }}
      imagePullSecrets: {{- toYaml . | nindent 8 }}
      {{- end }}
      containers:
        - name: admission
          image: {{ .Values.admission.image.repository }}:{{ .Values.admission.image.tag }}
          imagePullPolicy: {{ .Values.admission.image.pullPolicy }}
      args:
        - --webhook-namespace=kubeedge
        - --webhook-service-name=kubeedge-admission-service
        - --alsologtostderr
        - --port=443
        - -v=4
        - 2>&1
      restartPolicy: Always
      serviceAccountName: kubeedge-admission
      {{- with .Values.admission.affinity }}
      affinity: {{ toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.admission.tolerations }}
      tolerations: {{ toYaml . | nindent 8 }}
      {{- end }}
{{- end }}
